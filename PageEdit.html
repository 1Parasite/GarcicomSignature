<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PageEdit</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js">
  // ‚îÄ‚îÄ Country Code Data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const COUNTRIES = [
    {f:'üá©üáø',n:'Algeria',d:'213'},
    {f:'üá¶üá∫',n:'Australia',d:'61'},
    {f:'üá¶üáπ',n:'Austria',d:'43'},
    {f:'üáßüá™',n:'Belgium',d:'32'},
    {f:'üáßüá∑',n:'Brazil',d:'55'},
    {f:'üá®üá≤',n:'Cameroon',d:'237'},
    {f:'üá®üá¶',n:'Canada',d:'1'},
    {f:'üá®üá≥',n:'China',d:'86'},
    {f:'üá©üá∞',n:'Denmark',d:'45'},
    {f:'üá™üá¨',n:'Egypt',d:'20'},
    {f:'üá´üá∑',n:'France',d:'33'},
    {f:'üá©üá™',n:'Germany',d:'49'},
    {f:'üá¨üá≠',n:'Ghana',d:'233'},
    {f:'üáÆüá≥',n:'India',d:'91'},
    {f:'üáÆüáπ',n:'Italy',d:'39'},
    {f:'üáØüáµ',n:'Japan',d:'81'},
    {f:'üá∞üá™',n:'Kenya',d:'254'},
    {f:'üá∞üáº',n:'Kuwait',d:'965'},
    {f:'üá±üáæ',n:'Libya',d:'218'},
    {f:'üá≤üáΩ',n:'Mexico',d:'52'},
    {f:'üá≤üá¶',n:'Morocco',d:'212'},
    {f:'üá≥üá±',n:'Netherlands',d:'31'},
    {f:'üá≥üáø',n:'New Zealand',d:'64'},
    {f:'üá≥üá¨',n:'Nigeria',d:'234'},
    {f:'üá≥üá¥',n:'Norway',d:'47'},
    {f:'üáµüá±',n:'Poland',d:'48'},
    {f:'üáµüáπ',n:'Portugal',d:'351'},
    {f:'üá∂üá¶',n:'Qatar',d:'974'},
    {f:'üá∑üá∫',n:'Russia',d:'7'},
    {f:'üá∏üá¶',n:'Saudi Arabia',d:'966'},
    {f:'üá∏üá≥',n:'Senegal',d:'221'},
    {f:'üáøüá¶',n:'South Africa',d:'27'},
    {f:'üá∞üá∑',n:'South Korea',d:'82'},
    {f:'üá™üá∏',n:'Spain',d:'34'},
    {f:'üá∏üá™',n:'Sweden',d:'46'},
    {f:'üá®üá≠',n:'Switzerland',d:'41'},
    {f:'üáπüá≥',n:'Tunisia',d:'216'},
    {f:'üáπüá∑',n:'Turkey',d:'90'},
    {f:'üá¶üá™',n:'UAE',d:'971'},
    {f:'üá¨üáß',n:'United Kingdom',d:'44'},
    {f:'üá∫üá∏',n:'United States',d:'1'}
  ];

  let selectedCC = COUNTRIES[0];

  function buildCCList(filter) {
    const list = document.getElementById('cc-list');
    list.innerHTML = '';
    const filtered = filter
      ? COUNTRIES.filter(c => c.n.toLowerCase().includes(filter.toLowerCase()) || c.d.includes(filter))
      : COUNTRIES;
    filtered.forEach(country => {
      const div = document.createElement('div');
      div.className = 'cc-option' + (country.d === selectedCC.d && country.n === selectedCC.n ? ' selected' : '');
      div.innerHTML = `<span class="cc-flag">${country.f}</span><span class="cc-name">${country.n}</span><span class="cc-dial">+${country.d}</span>`;
      div.onclick = () => selectCC(country);
      list.appendChild(div);
    });
  }

  function selectCC(country) {
    selectedCC = country;
    document.getElementById('cc-flag').textContent = country.f;
    document.getElementById('cc-code').textContent = '+' + country.d;
    closeCCDropdown();
   
    scheduleQR(400);
  }

  function toggleCCDropdown() {
    const dd = document.getElementById('cc-dropdown');
    if (dd.style.display === 'none' || !dd.style.display) {
      dd.style.display = 'block';
      buildCCList('');
      document.getElementById('cc-search').focus();
    } else {
      closeCCDropdown();
    }
  }

  function closeCCDropdown() {
    document.getElementById('cc-dropdown').style.display = 'none';
    document.getElementById('cc-search').value = '';
  }

  function filterCC() {
    buildCCList(document.getElementById('cc-search').value);
  }

 
  document.addEventListener('click', e => {
    if (!document.getElementById('cc-picker').contains(e.target)) {
      closeCCDropdown();
    }
  });


  buildCCList('');


  
  let qrMode = 'auto';       
  let customQRDataURL = null; 

  function setQRMode(mode) {
    qrMode = mode;
    document.getElementById('btn-mode-auto').classList.toggle('active', mode === 'auto');
    document.getElementById('btn-mode-custom').classList.toggle('active', mode === 'custom');
    document.getElementById('qr-auto-panel').style.display   = mode === 'auto'   ? 'flex'     : 'none';
    document.getElementById('qr-custom-panel').style.display = mode === 'custom' ? 'flex'     : 'none';
  }

  function loadCustomQR(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      customQRDataURL = e.target.result;
      const preview = document.getElementById('custom-qr-preview');
      preview.src = customQRDataURL;
      preview.style.display = 'block';
      const zone = document.getElementById('qr-upload-zone');
      zone.classList.add('has-image');
      
      zone.querySelector('svg').style.display = 'none';
      zone.querySelector('p').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  function removeCustomQR(e) {
    e.stopPropagation();
    customQRDataURL = null;
    const preview = document.getElementById('custom-qr-preview');
    preview.src = '';
    preview.style.display = 'none';
    const zone = document.getElementById('qr-upload-zone');
    zone.classList.remove('has-image');
    zone.querySelector('svg').style.display = '';
    zone.querySelector('p').style.display = '';
    document.getElementById('custom-qr-input').value = '';
  }


  const _origGoToSignature = goToSignature;
 
  function goToSignature() {
    if (!validate()) return;
    const phone    = getFullPhone();
    const meetLink = document.getElementById('meet-input').value.trim();
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const params = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    if (meetLink) params.set('meet', meetLink);

    if (qrMode === 'custom' && customQRDataURL) {
      
      sessionStorage.setItem('customQR', customQRDataURL);
      params.set('customqr', '1');
    } else {
      sessionStorage.removeItem('customQR');
    }

    window.location.href = 'signature.html?' + params.toString();
  }

</script>
<style>
  :root {
    --navy: #0C144E;
    --purple: #8788FF;
    --purple-mid: #787AEA;
    --purple-light: #B2B3FF;
    --purple-c5: #C5C6FF;
    --purple-bg: #ECECFF;
    --grey: #F9F9F9;
    --white: #ffffff;
    --text-dim: #787AEA;
    --error: #e04444;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Sora', sans-serif;
    background: var(--grey);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
  }
  .header { display: flex; align-items: center; gap: 14px; margin-bottom: 40px; }
  .logo-img { height: 48px; width: auto; object-fit: contain; }
  .card {
    background: var(--white);
    border-radius: 20px;
    box-shadow: 0 8px 40px rgba(13,27,75,0.10), 0 2px 8px rgba(13,27,75,0.06);
    padding: 40px;
    width: 100%;
    max-width: 520px;
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  .card-title {
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--purple);
    margin-bottom: 24px;
  }
  .field {
    display: flex;
    flex-direction: column;
    gap: 7px;
    margin-bottom: 20px;
  }
  .field label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--navy);
  }
  .req-star { color: var(--error); font-size: 0.9rem; line-height: 1; }
  .opt-tag {
    font-size: 0.67rem;
    font-weight: 500;
    color: var(--text-dim);
    background: var(--purple-bg);
    border-radius: 20px;
    padding: 2px 8px;
    letter-spacing: 0.04em;
  }
  .input-wrapper {
    display: flex;
    align-items: center;
    border: 2px solid var(--purple-c5);
    border-radius: 12px;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: var(--grey);
  }
  #wrap-phone {
    overflow: visible;
    position: relative;
  }
  .input-wrapper:focus-within {
    border-color: var(--purple);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(135,136,255,.13);
  }
  .input-wrapper.error {
    border-color: var(--error) !important;
    box-shadow: 0 0 0 3px rgba(224,68,68,.10) !important;
    animation: shake 0.3s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25%     { transform: translateX(-5px); }
    75%     { transform: translateX(5px); }
  }
  .input-prefix {
    padding: 0 14px;
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    background: var(--purple-bg);
    height: 48px;
    display: flex;
    align-items: center;
    border-right: 2px solid var(--purple-c5);
    white-space: nowrap;
    flex-shrink: 0;
    user-select: none;
  }
  .input-wrapper input {
    flex: 1;
    border: none;
    outline: none;
    padding: 0 16px;
    font-family: 'DM Mono', monospace;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--navy);
    background: transparent;
    height: 48px;
    width: 100%;
  }
  .input-wrapper.url-input input { font-size: 0.82rem; }
  .hint { font-size: 0.73rem; color: var(--text-dim); margin-top: 4px; font-weight: 300; line-height: 1.5; }
  .error-msg { font-size: 0.72rem; color: var(--error); margin-top: 3px; display: none; }
  .field.has-error .error-msg { display: block; }
  .divider { height: 1px; background: var(--purple-bg); margin: 4px -40px 20px; }
  .dual-row { display: flex; gap: 10px; }
  .dual-row .input-wrapper { flex: 1; }


  .qr-section { display: flex; flex-direction: column; align-items: center; gap: 14px; margin: 8px 0 24px; }
  .qr-frame { position: relative; padding: 18px; background: var(--purple-bg); border-radius: 16px; }
  .qr-frame::before { content:''; position:absolute; top:6px; left:6px; width:22px; height:22px; border:3px solid var(--purple); border-right:none; border-bottom:none; border-radius:4px 0 0 0; }
  .qr-frame::after  { content:''; position:absolute; top:6px; right:6px; width:22px; height:22px; border:3px solid var(--purple); border-left:none; border-bottom:none; border-radius:0 4px 0 0; }
  .corner-bl { position:absolute; bottom:6px; left:6px; width:22px; height:22px; border:3px solid var(--purple); border-top:none; border-right:none; border-radius:0 0 0 4px; }
  .corner-br { position:absolute; bottom:6px; right:6px; width:22px; height:22px; border:3px solid var(--purple); border-top:none; border-left:none; border-radius:0 0 4px 0; }
  #qr-output { width:160px; height:160px; display:flex; align-items:center; justify-content:center; }
  #qr-output canvas, #qr-output img { border-radius:4px; }
  .qr-placeholder { width:160px; height:160px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; color:var(--purple-light); }
  .qr-placeholder p { font-size:0.72rem; text-align:center; font-weight:400; opacity:0.7; line-height:1.5; }
  .save-label { font-size:0.78rem; color:var(--text-dim); letter-spacing:0.03em; font-weight:600; }
  .qr-note { font-size:0.71rem; color:var(--text-dim); text-align:center; line-height:1.6; max-width:280px; }


  .btn-row { display: flex; gap: 12px; }
  .btn {
    flex:1; height:48px; border:none; border-radius:12px;
    font-family:'Sora',sans-serif; font-size:0.88rem; font-weight:600;
    cursor:pointer; transition:all 0.18s ease; letter-spacing:0.01em;
  }
  .btn-primary { background:var(--navy); color:var(--white); }
  .btn-primary:hover { background:#1a2d6b; transform:translateY(-1px); box-shadow:0 6px 20px rgba(13,27,75,0.25); }

  .footer-band {
    margin-top:32px;
    background:linear-gradient(135deg,var(--navy) 0%,#2a3a8a 100%);
    border-radius:14px; padding:18px 28px; width:100%; max-width:520px; text-align:center;
  }
  .footer-band p { font-size:0.82rem; color:rgba(255,255,255,0.65); font-weight:300; }
  .footer-band strong { color:var(--white); font-weight:600; }

  @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  .card,.header,.footer-band { animation:fadeUp 0.45s ease both; }
  .header      { animation-delay:0s; }
  .card        { animation-delay:0.08s; }
  .footer-band { animation-delay:0.16s; }
  @keyframes qrPop { from{opacity:0;transform:scale(0.88)} to{opacity:1;transform:scale(1)} }
  .qr-ready { animation:qrPop 0.25s cubic-bezier(.34,1.56,.64,1) both; }


  #cc-list::-webkit-scrollbar { width: 4px; }
  #cc-list::-webkit-scrollbar-track { background: transparent; }
  #cc-list::-webkit-scrollbar-thumb { background: var(--purple-c5); border-radius: 4px; }
  .cc-option {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 10px; border-radius: 8px; cursor: pointer;
    font-family: 'Sora', sans-serif; font-size: 0.8rem; color: var(--navy);
    transition: background 0.12s;
  }
  .cc-option:hover { background: var(--purple-bg); }
  .cc-option.selected { background: var(--purple-bg); font-weight: 600; }
  .cc-flag { font-size: 1.1rem; flex-shrink: 0; }
  .cc-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .cc-dial { font-family: 'DM Mono', monospace; font-size: 0.75rem; color: var(--text-dim); flex-shrink: 0; }

 
  .qr-mode-toggle {
    display: flex;
    background: var(--purple-bg);
    border-radius: 10px;
    padding: 4px;
    gap: 4px;
    margin-bottom: 16px;
    align-self: stretch;
  }
  .qr-mode-btn {
    flex: 1;
    height: 36px;
    border: none;
    border-radius: 7px;
    font-family: 'Sora', sans-serif;
    font-size: 0.73rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.18s;
    color: var(--text-dim);
    background: transparent;
    letter-spacing: 0;
    white-space: nowrap;
    overflow: hidden;
  }
  .qr-mode-btn.active {
    background: var(--white);
    color: var(--navy);
    box-shadow: 0 2px 8px rgba(12,20,78,0.10);
  }
  
  .qr-upload-zone {
    width: 196px;
    height: 196px;
    border: 2px dashed var(--purple-c5);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.18s;
    background: var(--grey);
    position: relative;
    overflow: hidden;
  }
  .qr-upload-zone:hover { border-color: var(--purple); background: var(--purple-bg); }
  .qr-upload-zone.has-image { border-style: solid; border-color: var(--purple-c5); padding: 0; }
  .qr-upload-zone img#custom-qr-preview {
    width: 100%; height: 100%;
    object-fit: contain;
    border-radius: 14px;
    display: block;
  }
  .qr-upload-zone p { font-size: 0.72rem; color: var(--text-dim); text-align: center; line-height: 1.5; font-weight: 400; }
  .qr-upload-zone svg { opacity: 0.5; }
  .upload-remove-btn {
    position: absolute; top: 6px; right: 6px;
    width: 22px; height: 22px;
    background: rgba(12,20,78,0.65);
    border: none; border-radius: 50%;
    color: #fff; font-size: 13px; line-height: 1;
    cursor: pointer; display: none;
    align-items: center; justify-content: center;
    font-weight: 700;
  }
  .qr-upload-zone.has-image .upload-remove-btn { display: flex; }
  #custom-qr-input { display: none; }
</style>
</head>
<body>

<div class="header">
  <img src="https://raw.githubusercontent.com/1Parasite/GarcicomSignature/refs/heads/main/assets/icones-ms-01.svg"
       alt="MS Solutions Logo" class="logo-img"
       onerror="this.src='https://raw.githubusercontent.com/1Parasite/GarcicomSignature/refs/heads/main/assets/icones-ms-01.png'" />
</div>

<div class="card">
  <p class="card-title">Signature Editor</p>

  <!-- Name + Surname -->
  <div class="field" id="field-name">
    <label>First Name &amp; Last Name <span class="req-star">*</span></label>
    <div class="dual-row">
      <div class="input-wrapper" id="wrap-name">
        <input type="text" id="name-input" placeholder="First name" autocomplete="off" />
      </div>
      <div class="input-wrapper" id="wrap-surname">
        <input type="text" id="surname-input" placeholder="LAST NAME" autocomplete="off" style="font-weight:700;text-transform:uppercase;" />
      </div>
    </div>
    <span class="error-msg">Please enter both first and last name.</span>
  </div>

  <div class="divider"></div>

  <!-- Function -->
  <div class="field" id="field-func">
    <label>Function / Job Title <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-func">
      <input type="text" id="function-input" placeholder="e.g. Sales Manager" autocomplete="off" />
    </div>
    <span class="error-msg">Please enter your job title.</span>
  </div>

  <div class="divider"></div>

  <!-- Email -->
  <div class="field" id="field-email">
    <label>Email Address <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-email">
      <span class="input-prefix">‚úâ</span>
      <input type="email" id="email-input" placeholder="name.surname@mssolutions-group.com" autocomplete="off" spellcheck="false" />
    </div>
    <span class="error-msg">Please enter a valid email address.</span>
  </div>

  <div class="divider"></div>

  <!-- Phone -->
  <div class="field" id="field-phone">
    <label>Phone / WhatsApp <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-phone" style="overflow:visible;position:relative;">
      <!-- Country code picker -->
      <div id="cc-picker" style="position:relative;flex-shrink:0;">
        <button type="button" id="cc-btn" onclick="toggleCCDropdown()" style="
          height:48px;padding:0 10px 0 12px;background:var(--purple-bg);
          border:none;border-right:2px solid var(--purple-c5);
          font-family:'DM Mono',monospace;font-size:0.82rem;color:var(--text-dim);
          cursor:pointer;display:flex;align-items:center;gap:6px;white-space:nowrap;
          outline:none;min-width:80px;max-width:100px;border-radius:10px 0 0 10px;">
          <span id="cc-flag">üáπüá≥</span>
          <span id="cc-code">+216</span>
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none" style="opacity:0.5;flex-shrink:0;">
            <path d="M1 1l4 4 4-4" stroke="#787AEA" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <!-- Dropdown -->
        <div id="cc-dropdown" style="
          display:none;position:absolute;top:52px;left:0;z-index:999;
          background:#fff;border:2px solid var(--purple-c5);border-radius:12px;
          box-shadow:0 8px 32px rgba(12,20,78,0.14);width:260px;overflow:hidden;">
          <div style="padding:8px;">
            <input type="text" id="cc-search" placeholder="Search country..." onkeyup="filterCC()" style="
              width:100%;height:36px;border:2px solid var(--purple-c5);border-radius:8px;
              padding:0 10px;font-family:'Sora',sans-serif;font-size:0.78rem;
              color:var(--navy);outline:none;background:var(--grey);">
          </div>
          <div id="cc-list" style="max-height:200px;overflow-y:auto;padding:0 4px 6px;">
          </div>
        </div>
      </div>
      <input type="tel" id="phone-input" placeholder="00 000 000" maxlength="15" inputmode="numeric" autocomplete="off" />
    </div>
    <p class="hint">The QR code will link directly to a WhatsApp chat with your full number.</p>
    <span class="error-msg">Please enter your phone number.</span>
  </div>

  <div class="divider"></div>

  <!-- LinkedIn -->
  <div class="field" id="field-linkedin">
    <label>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="#0C144E" style="flex-shrink:0;"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
      LinkedIn Profile <span class="req-star">*</span>
    </label>
    <div class="input-wrapper url-input" id="wrap-linkedin">
      <span class="input-prefix">linkedin.com</span>
      <input type="url" id="linkedin-input" placeholder="https://linkedin.com/in/your-profile" autocomplete="off" spellcheck="false" />
    </div>
    <p class="hint">Your personal LinkedIn profile URL ‚Äî will appear in the signature and contact page.</p>
    <span class="error-msg">Please enter your LinkedIn profile URL.</span>
  </div>

  <div class="divider"></div>

  <!-- Google Meet -->
  <div class="field">
    <label>Google Meet / Booking Link <span class="opt-tag">Optional</span></label>
    <div class="input-wrapper url-input" id="wrap-meet">
      <span class="input-prefix">üîó</span>
      <input type="url" id="meet-input" placeholder="https://meet.google.com/xxx-xxxx-xxx" autocomplete="off" spellcheck="false" />
    </div>
    <p class="hint">Linked to "Booking a meeting with me" in the signature.</p>
  </div>

  <!-- QR Preview -->
  <div class="qr-section">

    <!-- Mode toggle -->
    <div class="qr-mode-toggle">
      <button class="qr-mode-btn active" id="btn-mode-auto" onclick="setQRMode('auto')">‚ö° Auto</button>
      <button class="qr-mode-btn" id="btn-mode-custom" onclick="setQRMode('custom')">üìÅ Upload my QR</button>
    </div>

    <!-- Auto-generated QR -->
    <div id="qr-auto-panel" style="display:flex;flex-direction:column;align-items:center;gap:14px;">
      <div class="qr-frame">
        <span class="corner-bl"></span>
        <span class="corner-br"></span>
        <div id="qr-output">
          <div class="qr-placeholder">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="4" y="4" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
              <rect x="8" y="8" width="8" height="8" rx="1" fill="#7b7fd4"/>
              <rect x="28" y="4" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
              <rect x="32" y="8" width="8" height="8" rx="1" fill="#7b7fd4"/>
              <rect x="4" y="28" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
              <rect x="8" y="32" width="8" height="8" rx="1" fill="#7b7fd4"/>
              <rect x="28" y="28" width="5" height="5" rx="1" fill="#7b7fd4"/>
              <rect x="36" y="28" width="8" height="5" rx="1" fill="#7b7fd4"/>
              <rect x="28" y="36" width="8" height="8" rx="1" fill="#7b7fd4"/>
              <rect x="40" y="36" width="4" height="8" rx="1" fill="#7b7fd4"/>
            </svg>
            <p>Fill in your details<br>to preview QR</p>
          </div>
        </div>
      </div>
      <span class="save-label" style="margin-top:6px;">Scans to your contact page</span>
      <p class="qr-note">When scanned, opens a personal "Reach Out" page with your name, title, email, phone &amp; LinkedIn.</p>
    </div>

    <!-- Custom QR upload -->
    <div id="qr-custom-panel" style="display:none;flex-direction:column;align-items:center;gap:10px;">
      <div class="qr-upload-zone" id="qr-upload-zone" onclick="document.getElementById('custom-qr-input').click()">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#8788FF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        <p>Click to upload<br>your QR image</p>
        <img id="custom-qr-preview" src="" alt="" style="display:none;">
        <button class="upload-remove-btn" id="remove-custom-qr" onclick="removeCustomQR(event)">‚úï</button>
      </div>
      <input type="file" id="custom-qr-input" accept="image/*" onchange="loadCustomQR(event)">
      <p class="qr-note">Upload a PNG or JPG of your own QR code. It will be embedded in your signature.</p>
    </div>

  </div>

  <div class="btn-row">
    <button class="btn btn-primary" id="generate-btn" onclick="goToSignature()">Preview Signature ‚Üí</button>
  </div>
</div>

<div class="footer-band">
  <p>End-to-end Payment. <strong>Global Standards.</strong> Market-Level Simplicity.</p>
</div>

<script>
  let debounceTimer;
  let qrGenerated = false;

  
  ['name-input','surname-input','email-input','function-input'].forEach(id => {
    document.getElementById(id).addEventListener('input', () => scheduleQR(1000));
  });
  
  document.getElementById('phone-input').addEventListener('input', () => scheduleQR(800));
  
  document.getElementById('linkedin-input').addEventListener('input', () => {
    if (qrGenerated) scheduleQR(1200);
    else scheduleQR(1000);
  });

  document.addEventListener('keydown', e => { if (e.key === 'Enter') goToSignature(); });

  function scheduleQR(delay) {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(tryGenerateQR, delay);
  }

  function tryGenerateQR() {
    const phone = document.getElementById('phone-input').value.replace(/\D/g,'');
    if (phone.length >= 7) generateQR();
  }

  function getFullPhone() {
    const cc    = document.getElementById('cc-code').textContent.replace('+','');
    const local = document.getElementById('phone-input').value.replace(/\D/g,'');
    return cc + local;
  }

  function getContactURL() {
    const phone    = getFullPhone();
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();
    const params   = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    const base     = window.location.href.split('?')[0].replace(/PageEdit\.html$/i, '');
    return `${base}contact.html?${params.toString()}`;
  }


  const _qrScratch = document.createElement('div');
  _qrScratch.style.cssText = 'position:fixed;top:-9999px;left:-9999px;width:160px;height:160px;';
  document.body.appendChild(_qrScratch);

  function generateQR() {
    const url = getContactURL();
    _qrScratch.innerHTML = '';
    new QRCode(_qrScratch, {
      text: url,
      width: 160, height: 160,
      colorDark: '#0C144E', colorLight: '#ffffff',
      correctLevel: QRCode.CorrectLevel.H
    });
    
    setTimeout(() => {
      const canvas = _qrScratch.querySelector('canvas');
      if (!canvas) return;
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png');
      img.width = 160; img.height = 160;
      img.style.cssText = 'border-radius:4px;display:block;';
      const output = document.getElementById('qr-output');
      output.innerHTML = '';
      output.appendChild(img);
      output.classList.remove('qr-ready');
      void output.offsetWidth;
      output.classList.add('qr-ready');
      qrGenerated = true;
    }, 150);
  }

  function validate() {
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const phone    = document.getElementById('phone-input').value.replace(/\D/g,''); 
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const checks = [
      { ok: name && surname,              wrapIds:['wrap-name','wrap-surname'], fieldId:'field-name' },
      { ok: !!func,                        wrapIds:['wrap-func'],                fieldId:'field-func' },
      { ok: email && email.includes('@'),  wrapIds:['wrap-email'],               fieldId:'field-email' },
      { ok: phone.length >= 7,             wrapIds:['wrap-phone'],               fieldId:'field-phone' },
      { ok: !!linkedin,                    wrapIds:['wrap-linkedin'],            fieldId:'field-linkedin' },
    ];

    let valid = true;
    let firstError = null;
    checks.forEach(c => {
      const field = document.getElementById(c.fieldId);
      if (!c.ok) {
        valid = false;
        field.classList.add('has-error');
        if (!firstError) firstError = field;
        c.wrapIds.forEach(id => {
          const el = document.getElementById(id);
          el.classList.add('error');
          setTimeout(() => el.classList.remove('error'), 2200);
        });
      } else {
        field.classList.remove('has-error');
      }
    });
    if (firstError) firstError.scrollIntoView({ behavior:'smooth', block:'center' });
    return valid;
  }

  function goToSignature() {
    if (!validate()) return;
    const phone    = document.getElementById('phone-input').value.replace(/\D/g,''); // local digits
    const meetLink = document.getElementById('meet-input').value.trim();
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const params = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    if (meetLink) params.set('meet', meetLink);
    window.location.href = `signature.html?${params.toString()}`;
  }

 
  const COUNTRIES = [
    {f:'üá©üáø',n:'Algeria',d:'213'},
    {f:'üá¶üá∫',n:'Australia',d:'61'},
    {f:'üá¶üáπ',n:'Austria',d:'43'},
    {f:'üáßüá™',n:'Belgium',d:'32'},
    {f:'üáßüá∑',n:'Brazil',d:'55'},
    {f:'üá®üá≤',n:'Cameroon',d:'237'},
    {f:'üá®üá¶',n:'Canada',d:'1'},
    {f:'üá®üá≥',n:'China',d:'86'},
    {f:'üá©üá∞',n:'Denmark',d:'45'},
    {f:'üá™üá¨',n:'Egypt',d:'20'},
    {f:'üá´üá∑',n:'France',d:'33'},
    {f:'üá©üá™',n:'Germany',d:'49'},
    {f:'üá¨üá≠',n:'Ghana',d:'233'},
    {f:'üáÆüá≥',n:'India',d:'91'},
    {f:'üáÆüáπ',n:'Italy',d:'39'},
    {f:'üáØüáµ',n:'Japan',d:'81'},
    {f:'üá∞üá™',n:'Kenya',d:'254'},
    {f:'üá∞üáº',n:'Kuwait',d:'965'},
    {f:'üá±üáæ',n:'Libya',d:'218'},
    {f:'üá≤üáΩ',n:'Mexico',d:'52'},
    {f:'üá≤üá¶',n:'Morocco',d:'212'},
    {f:'üá≥üá±',n:'Netherlands',d:'31'},
    {f:'üá≥üáø',n:'New Zealand',d:'64'},
    {f:'üá≥üá¨',n:'Nigeria',d:'234'},
    {f:'üá≥üá¥',n:'Norway',d:'47'},
    {f:'üáµüá±',n:'Poland',d:'48'},
    {f:'üáµüáπ',n:'Portugal',d:'351'},
    {f:'üá∂üá¶',n:'Qatar',d:'974'},
    {f:'üá∑üá∫',n:'Russia',d:'7'},
    {f:'üá∏üá¶',n:'Saudi Arabia',d:'966'},
    {f:'üá∏üá≥',n:'Senegal',d:'221'},
    {f:'üáøüá¶',n:'South Africa',d:'27'},
    {f:'üá∞üá∑',n:'South Korea',d:'82'},
    {f:'üá™üá∏',n:'Spain',d:'34'},
    {f:'üá∏üá™',n:'Sweden',d:'46'},
    {f:'üá®üá≠',n:'Switzerland',d:'41'},
    {f:'üáπüá≥',n:'Tunisia',d:'216'},
    {f:'üáπüá∑',n:'Turkey',d:'90'},
    {f:'üá¶üá™',n:'UAE',d:'971'},
    {f:'üá¨üáß',n:'United Kingdom',d:'44'},
    {f:'üá∫üá∏',n:'United States',d:'1'}
  ];

  let selectedCC = COUNTRIES[0];

  function buildCCList(filter) {
    const list = document.getElementById('cc-list');
    list.innerHTML = '';
    const filtered = filter
      ? COUNTRIES.filter(c => c.n.toLowerCase().includes(filter.toLowerCase()) || c.d.includes(filter))
      : COUNTRIES;
    filtered.forEach(country => {
      const div = document.createElement('div');
      div.className = 'cc-option' + (country.d === selectedCC.d && country.n === selectedCC.n ? ' selected' : '');
      div.innerHTML = `<span class="cc-flag">${country.f}</span><span class="cc-name">${country.n}</span><span class="cc-dial">+${country.d}</span>`;
      div.onclick = () => selectCC(country);
      list.appendChild(div);
    });
  }

  function selectCC(country) {
    selectedCC = country;
    document.getElementById('cc-flag').textContent = country.f;
    document.getElementById('cc-code').textContent = '+' + country.d;
    closeCCDropdown();

    scheduleQR(400);
  }

  function toggleCCDropdown() {
    const dd = document.getElementById('cc-dropdown');
    if (dd.style.display === 'none' || !dd.style.display) {
      dd.style.display = 'block';
      buildCCList('');
      document.getElementById('cc-search').focus();
    } else {
      closeCCDropdown();
    }
  }

  function closeCCDropdown() {
    document.getElementById('cc-dropdown').style.display = 'none';
    document.getElementById('cc-search').value = '';
  }

  function filterCC() {
    buildCCList(document.getElementById('cc-search').value);
  }

  document.addEventListener('click', e => {
    if (!document.getElementById('cc-picker').contains(e.target)) {
      closeCCDropdown();
    }
  });

  buildCCList('');


  let qrMode = 'auto';       

  function setQRMode(mode) {
    qrMode = mode;
    document.getElementById('btn-mode-auto').classList.toggle('active', mode === 'auto');
    document.getElementById('btn-mode-custom').classList.toggle('active', mode === 'custom');
    document.getElementById('qr-auto-panel').style.display   = mode === 'auto'   ? 'flex'     : 'none';
    document.getElementById('qr-custom-panel').style.display = mode === 'custom' ? 'flex'     : 'none';
  }

  function loadCustomQR(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      customQRDataURL = e.target.result;
      const preview = document.getElementById('custom-qr-preview');
      preview.src = customQRDataURL;
      preview.style.display = 'block';
      const zone = document.getElementById('qr-upload-zone');
      zone.classList.add('has-image');
    
      zone.querySelector('svg').style.display = 'none';
      zone.querySelector('p').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }

  function removeCustomQR(e) {
    e.stopPropagation();
    customQRDataURL = null;
    const preview = document.getElementById('custom-qr-preview');
    preview.src = '';
    preview.style.display = 'none';
    const zone = document.getElementById('qr-upload-zone');
    zone.classList.remove('has-image');
    zone.querySelector('svg').style.display = '';
    zone.querySelector('p').style.display = '';
    document.getElementById('custom-qr-input').value = '';
  }

    const _origGoToSignature = goToSignature;
  
  function goToSignature() {
    if (!validate()) return;
    const phone    = getFullPhone();
    const meetLink = document.getElementById('meet-input').value.trim();
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const params = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    if (meetLink) params.set('meet', meetLink);

    if (qrMode === 'custom' && customQRDataURL) {
     
      sessionStorage.setItem('customQR', customQRDataURL);
      params.set('customqr', '1');
    } else {
      sessionStorage.removeItem('customQR');
    }

    window.location.href = 'signature.html?' + params.toString();
  }

</script>
</body>
</html>