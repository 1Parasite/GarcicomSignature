<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PageEdit</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
  :root {
    --navy: #0C144E;
    --purple: #8788FF;
    --purple-mid: #787AEA;
    --purple-light: #B2B3FF;
    --purple-c5: #C5C6FF;
    --purple-bg: #ECECFF;
    --grey: #F9F9F9;
    --white: #ffffff;
    --text-dim: #787AEA;
    --error: #e04444;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Sora', sans-serif;
    background: var(--grey);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
  }
  .header { display: flex; align-items: center; gap: 14px; margin-bottom: 40px; }
  .logo-img { height: 48px; width: auto; object-fit: contain; }
  .card {
    background: var(--white);
    border-radius: 20px;
    box-shadow: 0 8px 40px rgba(13,27,75,0.10), 0 2px 8px rgba(13,27,75,0.06);
    padding: 40px;
    width: 100%;
    max-width: 520px;
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  .card-title {
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--purple);
    margin-bottom: 24px;
  }
  .field {
    display: flex;
    flex-direction: column;
    gap: 7px;
    margin-bottom: 20px;
  }
  .field label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--navy);
  }
  .req-star { color: var(--error); font-size: 0.9rem; line-height: 1; }
  .opt-tag {
    font-size: 0.67rem;
    font-weight: 500;
    color: var(--text-dim);
    background: var(--purple-bg);
    border-radius: 20px;
    padding: 2px 8px;
    letter-spacing: 0.04em;
  }
  .input-wrapper {
    display: flex;
    align-items: center;
    border: 2px solid var(--purple-c5);
    border-radius: 12px;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: var(--grey);
  }
  .input-wrapper:focus-within {
    border-color: var(--purple);
    background: var(--white);
    box-shadow: 0 0 0 3px rgba(135,136,255,.13);
  }
  .input-wrapper.error {
    border-color: var(--error) !important;
    box-shadow: 0 0 0 3px rgba(224,68,68,.10) !important;
    animation: shake 0.3s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25%     { transform: translateX(-5px); }
    75%     { transform: translateX(5px); }
  }
  .input-prefix {
    padding: 0 14px;
    font-family: 'DM Mono', monospace;
    font-size: 0.82rem;
    color: var(--text-dim);
    background: var(--purple-bg);
    height: 48px;
    display: flex;
    align-items: center;
    border-right: 2px solid var(--purple-c5);
    white-space: nowrap;
    flex-shrink: 0;
    user-select: none;
  }
  .input-wrapper input {
    flex: 1;
    border: none;
    outline: none;
    padding: 0 16px;
    font-family: 'DM Mono', monospace;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--navy);
    background: transparent;
    height: 48px;
    width: 100%;
  }
  .input-wrapper.url-input input { font-size: 0.82rem; }
  .hint { font-size: 0.73rem; color: var(--text-dim); margin-top: 4px; font-weight: 300; line-height: 1.5; }
  .error-msg { font-size: 0.72rem; color: var(--error); margin-top: 3px; display: none; }
  .field.has-error .error-msg { display: block; }
  .divider { height: 1px; background: var(--purple-bg); margin: 4px -40px 20px; }
  .dual-row { display: flex; gap: 10px; }
  .dual-row .input-wrapper { flex: 1; }

  /* QR */
  .qr-section { display: flex; flex-direction: column; align-items: center; gap: 14px; margin: 8px 0 24px; }
  .qr-frame { position: relative; padding: 18px; background: var(--purple-bg); border-radius: 16px; }
  .qr-frame::before { content:''; position:absolute; top:6px; left:6px; width:22px; height:22px; border:3px solid var(--purple); border-right:none; border-bottom:none; border-radius:4px 0 0 0; }
  .qr-frame::after  { content:''; position:absolute; top:6px; right:6px; width:22px; height:22px; border:3px solid var(--purple); border-left:none; border-bottom:none; border-radius:0 4px 0 0; }
  .corner-bl { position:absolute; bottom:6px; left:6px; width:22px; height:22px; border:3px solid var(--purple); border-top:none; border-right:none; border-radius:0 0 0 4px; }
  .corner-br { position:absolute; bottom:6px; right:6px; width:22px; height:22px; border:3px solid var(--purple); border-top:none; border-left:none; border-radius:0 0 4px 0; }
  #qr-output { width:160px; height:160px; display:flex; align-items:center; justify-content:center; }
  #qr-output canvas, #qr-output img { border-radius:4px; }
  .qr-placeholder { width:160px; height:160px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; color:var(--purple-light); }
  .qr-placeholder p { font-size:0.72rem; text-align:center; font-weight:400; opacity:0.7; line-height:1.5; }
  .save-label { font-size:0.78rem; color:var(--text-dim); letter-spacing:0.03em; font-weight:600; }
  .qr-note { font-size:0.71rem; color:var(--text-dim); text-align:center; line-height:1.6; max-width:280px; }

  /* Button */
  .btn-row { display: flex; gap: 12px; }
  .btn {
    flex:1; height:48px; border:none; border-radius:12px;
    font-family:'Sora',sans-serif; font-size:0.88rem; font-weight:600;
    cursor:pointer; transition:all 0.18s ease; letter-spacing:0.01em;
  }
  .btn-primary { background:var(--navy); color:var(--white); }
  .btn-primary:hover { background:#1a2d6b; transform:translateY(-1px); box-shadow:0 6px 20px rgba(13,27,75,0.25); }

  .footer-band {
    margin-top:32px;
    background:linear-gradient(135deg,var(--navy) 0%,#2a3a8a 100%);
    border-radius:14px; padding:18px 28px; width:100%; max-width:520px; text-align:center;
  }
  .footer-band p { font-size:0.82rem; color:rgba(255,255,255,0.65); font-weight:300; }
  .footer-band strong { color:var(--white); font-weight:600; }

  @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  .card,.header,.footer-band { animation:fadeUp 0.45s ease both; }
  .header      { animation-delay:0s; }
  .card        { animation-delay:0.08s; }
  .footer-band { animation-delay:0.16s; }
  @keyframes qrPop { from{opacity:0;transform:scale(0.88)} to{opacity:1;transform:scale(1)} }
  .qr-ready { animation:qrPop 0.25s cubic-bezier(.34,1.56,.64,1) both; }
</style>
</head>
<body>

<div class="header">
  <img src="https://raw.githubusercontent.com/1Parasite/GarcicomSignature/refs/heads/main/assets/icones-ms-01.svg"
       alt="MS Solutions Logo" class="logo-img"
       onerror="this.src='https://raw.githubusercontent.com/1Parasite/GarcicomSignature/refs/heads/main/assets/icones-ms-01.png'" />
</div>

<div class="card">
  <p class="card-title">Signature Editor</p>

  <!-- Name + Surname -->
  <div class="field" id="field-name">
    <label>First Name &amp; Last Name <span class="req-star">*</span></label>
    <div class="dual-row">
      <div class="input-wrapper" id="wrap-name">
        <input type="text" id="name-input" placeholder="First name" autocomplete="off" />
      </div>
      <div class="input-wrapper" id="wrap-surname">
        <input type="text" id="surname-input" placeholder="LAST NAME" autocomplete="off" style="font-weight:700;text-transform:uppercase;" />
      </div>
    </div>
    <span class="error-msg">Please enter both first and last name.</span>
  </div>

  <div class="divider"></div>

  <!-- Function -->
  <div class="field" id="field-func">
    <label>Function / Job Title <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-func">
      <input type="text" id="function-input" placeholder="e.g. Sales Manager" autocomplete="off" />
    </div>
    <span class="error-msg">Please enter your job title.</span>
  </div>

  <div class="divider"></div>

  <!-- Email -->
  <div class="field" id="field-email">
    <label>Email Address <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-email">
      <span class="input-prefix">âœ‰</span>
      <input type="email" id="email-input" placeholder="name.surname@mssolutions-group.com" autocomplete="off" spellcheck="false" />
    </div>
    <span class="error-msg">Please enter a valid email address.</span>
  </div>

  <div class="divider"></div>

  <!-- Phone -->
  <div class="field" id="field-phone">
    <label>Phone / WhatsApp <span class="req-star">*</span></label>
    <div class="input-wrapper" id="wrap-phone">
      <span class="input-prefix">+216</span>
      <input type="tel" id="phone-input" placeholder="00 000 000" maxlength="12" inputmode="numeric" autocomplete="off" />
    </div>
    <p class="hint">The QR code will open a personal contact page with all your details.</p>
    <span class="error-msg">Please enter your phone number.</span>
  </div>

  <div class="divider"></div>

  <!-- LinkedIn -->
  <div class="field" id="field-linkedin">
    <label>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="#0C144E" style="flex-shrink:0;"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
      LinkedIn Profile <span class="req-star">*</span>
    </label>
    <div class="input-wrapper url-input" id="wrap-linkedin">
      <span class="input-prefix">linkedin.com</span>
      <input type="url" id="linkedin-input" placeholder="https://linkedin.com/in/your-profile" autocomplete="off" spellcheck="false" />
    </div>
    <p class="hint">Your personal LinkedIn profile URL â€” will appear in the signature and contact page.</p>
    <span class="error-msg">Please enter your LinkedIn profile URL.</span>
  </div>

  <div class="divider"></div>

  <!-- Google Meet (optional) -->
  <div class="field">
    <label>Google Meet / Booking Link <span class="opt-tag">Optional</span></label>
    <div class="input-wrapper url-input" id="wrap-meet">
      <span class="input-prefix">ðŸ”—</span>
      <input type="url" id="meet-input" placeholder="https://meet.google.com/xxx-xxxx-xxx" autocomplete="off" spellcheck="false" />
    </div>
    <p class="hint">Linked to "Booking a meeting with me" in the signature.</p>
  </div>

  <!-- QR Preview -->
  <div class="qr-section">
    <div class="qr-frame">
      <span class="corner-bl"></span>
      <span class="corner-br"></span>
      <div id="qr-output">
        <div class="qr-placeholder">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="4" y="4" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
            <rect x="8" y="8" width="8" height="8" rx="1" fill="#7b7fd4"/>
            <rect x="28" y="4" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
            <rect x="32" y="8" width="8" height="8" rx="1" fill="#7b7fd4"/>
            <rect x="4" y="28" width="16" height="16" rx="2" stroke="#7b7fd4" stroke-width="2.5"/>
            <rect x="8" y="32" width="8" height="8" rx="1" fill="#7b7fd4"/>
            <rect x="28" y="28" width="5" height="5" rx="1" fill="#7b7fd4"/>
            <rect x="36" y="28" width="8" height="5" rx="1" fill="#7b7fd4"/>
            <rect x="28" y="36" width="8" height="8" rx="1" fill="#7b7fd4"/>
            <rect x="40" y="36" width="4" height="8" rx="1" fill="#7b7fd4"/>
          </svg>
          <p>Fill in your details<br>to preview QR</p>
        </div>
      </div>
    </div>
    <span class="save-label">Scans to your contact page</span>
    <p class="qr-note">When scanned, opens a personal "Reach Out" page with your name, title, email, phone &amp; LinkedIn.</p>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" id="generate-btn" onclick="goToSignature()">Preview Signature â†’</button>
  </div>
</div>

<div class="footer-band">
  <p>End-to-end Payment. <strong>Global Standards.</strong> Market-Level Simplicity.</p>
</div>

<script>
  let debounceTimer;
  let qrGenerated = false;

  // Regular fields: refresh QR after 1s idle
  ['name-input','surname-input','email-input','function-input'].forEach(id => {
    document.getElementById(id).addEventListener('input', () => scheduleQR(1000));
  });
  // Phone: slightly faster since it's the trigger
  document.getElementById('phone-input').addEventListener('input', () => scheduleQR(800));
  // LinkedIn: only refresh if QR already exists â€” avoids blank flash on first long URL paste
  document.getElementById('linkedin-input').addEventListener('input', () => {
    if (qrGenerated) scheduleQR(1200);
    else scheduleQR(1000);
  });

  document.addEventListener('keydown', e => { if (e.key === 'Enter') goToSignature(); });

  function scheduleQR(delay) {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(tryGenerateQR, delay);
  }

  function tryGenerateQR() {
    const phone = document.getElementById('phone-input').value.replace(/\D/g,'');
    if (phone.length >= 7) generateQR();
  }

  function getContactURL() {
    const phone    = document.getElementById('phone-input').value.replace(/\D/g,'');
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();
    const params   = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    const base     = window.location.href.split('?')[0].replace(/PageEdit\.html$/i, '');
    return `${base}contact.html?${params.toString()}`;
  }

  // Off-screen scratch pad â€” render there first, then swap atomically so visible QR never blanks
  const _qrScratch = document.createElement('div');
  _qrScratch.style.cssText = 'position:fixed;top:-9999px;left:-9999px;width:160px;height:160px;';
  document.body.appendChild(_qrScratch);

  function generateQR() {
    const url = getContactURL();
    _qrScratch.innerHTML = '';
    new QRCode(_qrScratch, {
      text: url,
      width: 160, height: 160,
      colorDark: '#0C144E', colorLight: '#ffffff',
      correctLevel: QRCode.CorrectLevel.H
    });
    // Give QRCode lib time to finish drawing, then swap in one frame
    setTimeout(() => {
      const canvas = _qrScratch.querySelector('canvas');
      if (!canvas) return;
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png');
      img.width = 160; img.height = 160;
      img.style.cssText = 'border-radius:4px;display:block;';
      const output = document.getElementById('qr-output');
      output.innerHTML = '';
      output.appendChild(img);
      output.classList.remove('qr-ready');
      void output.offsetWidth;
      output.classList.add('qr-ready');
      qrGenerated = true;
    }, 150);
  }

  function validate() {
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const phone    = document.getElementById('phone-input').value.replace(/\D/g,'');
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const checks = [
      { ok: name && surname,              wrapIds:['wrap-name','wrap-surname'], fieldId:'field-name' },
      { ok: !!func,                        wrapIds:['wrap-func'],                fieldId:'field-func' },
      { ok: email && email.includes('@'),  wrapIds:['wrap-email'],               fieldId:'field-email' },
      { ok: phone.length >= 7,             wrapIds:['wrap-phone'],               fieldId:'field-phone' },
      { ok: !!linkedin,                    wrapIds:['wrap-linkedin'],            fieldId:'field-linkedin' },
    ];

    let valid = true;
    let firstError = null;
    checks.forEach(c => {
      const field = document.getElementById(c.fieldId);
      if (!c.ok) {
        valid = false;
        field.classList.add('has-error');
        if (!firstError) firstError = field;
        c.wrapIds.forEach(id => {
          const el = document.getElementById(id);
          el.classList.add('error');
          setTimeout(() => el.classList.remove('error'), 2200);
        });
      } else {
        field.classList.remove('has-error');
      }
    });
    if (firstError) firstError.scrollIntoView({ behavior:'smooth', block:'center' });
    return valid;
  }

  function goToSignature() {
    if (!validate()) return;
    const phone    = document.getElementById('phone-input').value.replace(/\D/g,'');
    const meetLink = document.getElementById('meet-input').value.trim();
    const name     = document.getElementById('name-input').value.trim();
    const surname  = document.getElementById('surname-input').value.trim();
    const func     = document.getElementById('function-input').value.trim();
    const email    = document.getElementById('email-input').value.trim();
    const linkedin = document.getElementById('linkedin-input').value.trim();

    const params = new URLSearchParams({ phone, name, surname, func, email, linkedin });
    if (meetLink) params.set('meet', meetLink);
    window.location.href = `signature.html?${params.toString()}`;
  }
</script>
</body>
</html>